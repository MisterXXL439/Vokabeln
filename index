<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vokabeltrainer</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; padding: 30px; background: #f0f4f8; }
  h1 { color: #333; margin-bottom: 10px; font-size: 2.2em; }
  #question { font-size: 2.0em; margin: 25px; color: #1a73e8; }
  #answer { font-size: 1.5em; padding: 12px; width: 220px; text-align: center; border-radius: 10px; border: 2px solid #ccc; }
  #feedback { margin: 20px; font-size: 1.3em; height: 2em; }
  #score { margin: 20px; font-size: 1.1em; white-space: pre-line; }
  #progressBarContainer { width: 80%; max-width: 400px; height: 25px; background: #ccc; margin: 10px auto; border-radius: 15px; overflow: hidden; }
  #progressBar { width: 0%; height: 100%; background: #34a853; transition: width 0.3s; }
  #finalBarContainer { width: 80%; max-width: 400px; height: 25px; background: #ddd; margin: 20px auto; border-radius: 15px; overflow: hidden; display:none; position: relative; }
  #finalCorrect { height: 100%; background: #34a853; float:left; }
  #finalWrong { height: 100%; background: #ea4335; float:left; }
  #finalPercent { position: absolute; width: 100%; text-align: center; top: 0; left: 0; line-height: 25px; font-weight: bold; color: white; text-shadow: 1px 1px 2px black; }
  select, button { font-size: 1.2em; padding: 10px 18px; margin: 10px; border-radius: 10px; border: none; cursor: pointer; }
  select { background: #f0f0f0; color: #333; }
  button { background: #1a73e8; color: white; }
  button:active { background: #1665c1; }
  input:focus { outline: none; border-color: #1a73e8; }
</style>
</head>
<body>

<h1>Vokabeltrainer</h1>

<div>
  Richtung:
  <select id="directionSelect">
    <option value="en-de">Englisch → Deutsch</option>
    <option value="de-en">Deutsch → Englisch</option>
  </select>
  Wiederholungen:
  <select id="repeatSelect">
    <script>
      for(let i=1;i<=5;i++){ document.write(`<option value="${i}" ${i===3?'selected':''}>${i}</option>`); }
    </script>
  </select>
  <button id="startBtn">Start</button>
  <button id="resetBtn">Fortschritt zurücksetzen</button>
</div>

<div id="question">Drücke Start, um zu beginnen</div>
<input type="text" id="answer" placeholder="Antwort eingeben" disabled>
<div id="progressBarContainer"><div id="progressBar"></div></div>
<div id="feedback"></div>
<div id="score"></div>

<div id="finalBarContainer">
  <div id="finalCorrect"></div>
  <div id="finalWrong"></div>
  <div id="finalPercent"></div>
</div>

<script>
// --- Vokabeln (Platzhalter, erweiterbar auf hunderte) ---
const vocab = [
  {en: "apple", de: "Apfel"},
  {en: "house", de: "Haus"},
  {en: "dog", de: "Hund"},
  {en: "car", de: "Auto"},
  {en: "book", de: "Buch"},
  {en: "school", de: "Schule"},
  {en: "tree", de: "Baum"},
  {en: "friend", de: "Freund"},
  {en: "family", de: "Familie"},
  {en: "water", de: "Wasser"}
  // 👉 Hier kannst du beliebig viele Vokabelpaare hinzufügen
];

let richtigZaehler = {};
let falschZaehler = {};
let repeatTarget = 3;
let currentWord = null;
let lastWord = null;
let totalCorrect = 0;
let totalAnswers = 0;
let direction = "en-de";
let quizActive = false;

// Fortschritt speichern
function saveProgress() {
  const progressData = {
    richtigZaehler,
    falschZaehler,
    totalCorrect,
    totalAnswers,
    repeatTarget,
    direction
  };
  localStorage.setItem("vocabProgress", JSON.stringify(progressData));
}

// Fortschritt laden
function loadProgress() {
  const data = localStorage.getItem("vocabProgress");
  if (data) {
    const saved = JSON.parse(data);
    richtigZaehler = saved.richtigZaehler;
    falschZaehler = saved.falschZaehler;
    totalCorrect = saved.totalCorrect;
    totalAnswers = saved.totalAnswers;
    repeatTarget = saved.repeatTarget;
    direction = saved.direction;
    document.getElementById("directionSelect").value = direction;
    document.getElementById("repeatSelect").value = repeatTarget;
    updateProgress();
    updateScore();
  } else {
    resetCounters();
  }
}

// Fortschritt zurücksetzen
function resetProgress() {
  localStorage.removeItem("vocabProgress");
  resetCounters();
  totalCorrect = 0;
  totalAnswers = 0;
  updateProgress();
  updateScore();
  document.getElementById("question").innerText = "Fortschritt gelöscht – neu starten!";
}

// Zähler zurücksetzen
function resetCounters() {
  richtigZaehler = {};
  falschZaehler = {};
  vocab.forEach((v,i) => {
    richtigZaehler[i] = 0;
    falschZaehler[i] = 0;
  });
}

function pickRandomWord() {
  let remaining = vocab.map((_,i)=>i).filter(i => richtigZaehler[i] < repeatTarget);
  if (remaining.length === 0) return null;

  if (remaining.length > 1 && lastWord !== null) {
    remaining = remaining.filter(i => i !== lastWord);
    if (remaining.length === 0) remaining = vocab.map((_,i)=>i).filter(i => richtigZaehler[i] < repeatTarget);
  }

  const index = remaining[Math.floor(Math.random()*remaining.length)];
  lastWord = index;
  return index;
}

function startQuiz() {
  quizActive = true;
  document.getElementById("startBtn").disabled = true;
  document.getElementById("answer").disabled = false;
  document.getElementById("answer").focus();
  direction = document.getElementById("directionSelect").value;
  repeatTarget = parseInt(document.getElementById("repeatSelect").value);
  totalCorrect = 0;
  totalAnswers = 0;
  resetCounters();
  document.getElementById("progressBar").style.width = "0%";
  document.getElementById("finalBarContainer").style.display = "none";
  nextQuestion();
}

function nextQuestion() {
  currentWord = pickRandomWord();
  if (currentWord === null) {
    endQuiz();
    return;
  }

  let q = (direction==="en-de") ? vocab[currentWord].en : vocab[currentWord].de;
  document.getElementById("question").innerText = q;
  document.getElementById("answer").value = "";
  document.getElementById("answer").focus();
  document.getElementById("feedback").innerText = "";
}

function checkAnswer() {
  totalAnswers++;
  let input = document.getElementById("answer").value.trim().toLowerCase();
  let correct = (direction==="en-de") ? vocab[currentWord].de.toLowerCase() : vocab[currentWord].en.toLowerCase();

  if (input === correct) {
    richtigZaehler[currentWord]++;
    totalCorrect++;
    document.getElementById("feedback").innerText = "✅ Richtig!";
    document.getElementById("feedback").style.color = "green";
    updateProgress();
  } else {
    falschZaehler[currentWord]++;
    document.getElementById("feedback").innerText = `❌ Falsch! Richtige Antwort: ${correct}`;
    document.getElementById("feedback").style.color = "red";
  }
  updateScore();
  saveProgress();
  setTimeout(nextQuestion, 1000);
}

function updateScore() {
  let text = `Ziel: ${repeatTarget}x pro Wort\n`;
  vocab.forEach((v,i)=>{
    let word = (direction==="en-de")?v.en:v.de;
    text += `${word}: ${richtigZaehler[i]} / ${repeatTarget}\n`;
  });
  document.getElementById("score").innerText = text;
}

function updateProgress() {
  const totalTarget = repeatTarget * vocab.length;
  const progress = Math.min(100,(totalCorrect/totalTarget)*100);
  document.getElementById("progressBar").style.width = progress + "%";
}

function endQuiz() {
  document.getElementById("question").innerText = "🎉 Alle Vokabeln geschafft! 🎉";
  document.getElementById("answer").disabled = true;
  document.getElementById("feedback").innerText = "";
  document.getElementById("score").innerText = "";
  document.getElementById("startBtn").disabled = false;
  quizActive = false;

  const correctPercent = totalAnswers ? (totalCorrect/totalAnswers)*100 : 0;
  document.getElementById("finalBarContainer").style.display = "block";
  document.getElementById("finalCorrect").style.width = correctPercent + "%";
  document.getElementById("finalWrong").style.width = (100-correctPercent) + "%";
  document.getElementById("finalPercent").innerText = Math.round(correctPercent)+"% richtig";

  saveProgress();
}

document.getElementById("startBtn").addEventListener("click", startQuiz);
document.getElementById("resetBtn").addEventListener("click", resetProgress);
document.getElementById("answer").addEventListener("keydown",(e)=>{ if(e.key==="Enter") checkAnswer(); });

// Lade Fortschritt beim Start
window.onload = loadProgress;
</script>

</body>
</html>
